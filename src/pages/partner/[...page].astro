---
import type { Page, PaginateFunction } from 'astro'
import type { CollectionEntry } from 'astro:content'
import { Image } from 'astro:assets'
import type { Frontmatter } from '../../config'
import { getCollection } from 'astro:content'
import { SiteMetadata, PAGE_SIZE } from '../../config'
import Base from '../../layouts/base.astro'
import PageHero from '../../components/pagehero.astro'
import PaginateControl from '../../components/paginatecontrol.astro'
import { DefaultImage } from '../../config'

export interface Props {
  page: Page<CollectionEntry<'partner'>>
}

const { page } = Astro.props

const frontmatter: Frontmatter = {
  title:
    'Partners' +
    (page.size < page.total ? ' (page ' + page.currentPage + ' of ' + page.lastPage + ')' : ''),
  description: 'View our participating partners.',
  coverImage: DefaultImage,
  publishDate: SiteMetadata.buildTime
}

const currentPage = Astro.url.pathname.replace(/(\/\d*)?\/$/, '')
export async function getStaticPaths({ paginate }: { paginate: PaginateFunction }) {
  const allPosts = await getCollection('partner', ({ data }) => {
    return data.draft !== true
  })
  const posts = allPosts // .sort((a, b) => +b.data.publishDate - +a.data.publishDate)

  return paginate(posts, { pageSize: PAGE_SIZE })
}
---

<Base frontmatter={frontmatter}>
  <header>
    <PageHero
      title={frontmatter.title}
      description={frontmatter.description}
      coverImage={DefaultImage}
    >
      <PaginateControl base={currentPage} page={page} />
    </PageHero>
  </header>
<main class="bg-white">
  <div class="mx-auto max-w-2xl px-4 py-16 sm:px-6 sm:py-24 lg:max-w-7xl lg:px-8">
    <div class="mt-6 grid grid-cols-1 gap-x-6 gap-y-10 sm:grid-cols-2 lg:grid-cols-4 xl:gap-x-8">
      {page.data.map(partner => (
        <div class="group relative">
          <div class="w-full overflow-hidden rounded-md bg-gray-200 group-hover:opacity-75">
            <Image src={partner.data.image} alt={partner.data.title} class="h-full w-full object-cover object-center lg:h-full lg:w-full">
          </div>
          <div class="mt-4 flex justify-between">
            <div>
              <h3 class="text-xl text-gray-700">
                <a href={import.meta.env.BASE_URL + 'partner/' + partner.slug}>
                  <span aria-hidden="true" class="absolute inset-0"></span>
                  {partner.data.title}
                </a>
              </h3>
              <p class="mt-1 text-sm text-gray-500">{partner.data.cuisine}</p>
            </div>
            <p class="text-sm font-medium text-gray-900">{partner.data.discount_pct}%</p>
          </div>
        </div>
      ))}
    </div>
  </div>
</main>

</Base>
